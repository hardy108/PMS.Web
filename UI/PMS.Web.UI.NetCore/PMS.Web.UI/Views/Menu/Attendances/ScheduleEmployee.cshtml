@using PMS.Web.UI.Code
@using PMS.Shared.Models
@{

    ViewData["Title"] = "Jadwal Karyawan";
    Layout = null;

    string mode = ViewBag.Mode;
}
<x-form id="@ViewBag.MainFormID">
    <x-form-row>
        <input type="hidden" name="ID" id="ID" data-bf="ID" />
        <input type="hidden" name="STATUS" id="STATUS" data-bf="STATUS" />
        <x-field-data-list-unit-by-user-name id="UNITID" caption="Estate" xs-size="12" md-size="4" read-only="@ViewBag.ReadOnlyWhenNotInsert" binding-field="UNITID" min-length-search="0">
        </x-field-data-list-unit-by-user-name>
        <x-field-data-list-employee id="EMPLOYEEID" caption="Karyawan" xs-size="12" md-size="4" read-only="@ViewBag.ReadOnlyWhenNotInsert" binding-field="EMPLOYEEID" min-length-search="3"
                                    chain-to-relatives="@(!ViewBag.ReadOnlyWhenNotInsert)" 
                                    ascendants="@(ViewBag.ReadOnlyWhenNotInsert ? new List<FilterAscendant>() : new List<FilterAscendant> { new FilterAscendant { ElementID="UNITID",FieldID = "UnitID"}})">
                                    is-unit-mandatory="true">
        </x-field-data-list-employee>
        <x-field-date binding-field="DATE" caption="Tanggal" read-only="@ViewBag.ReadOnlyWhenNotInsert" xs-size="12" md-size="2" picker-option="DateOnly" date-format="dd-MMM-yyyy">
        </x-field-date>
        <x-field-select id="HOLIDAY" binding-field="HOLIDAY" caption="Libur" read-only="@ViewBag.ReadOnly" xs-size="12" md-size="2" select-type="Boolean"></x-field-select>
    </x-form-row>
    <x-form-row id="pnlHoliday1">
        <x-form-col xs-size="12" md-size="6">
            <x-form-row no-gutters="true">
                <x-field-date id="INSTART" picker-option="TimeOnly" xs-size="6" caption="Batas Datang" time-format="HH:mm" binding-field="INSTART" read-only="@ViewBag.ReadOnly"></x-field-date>
                <x-field-date id="INEND" picker-option="TimeOnly" xs-size="6" caption="&nbsp;" time-format="HH:mm" binding-field="INEND" read-only="@ViewBag.ReadOnly"></x-field-date>
            </x-form-row>
        </x-form-col>
        @*<script>helper.initDateRange2('INSTART', 'INEND', 'HH:mm')</script>*@
        <x-form-col xs-size="12" md-size="6">
            <x-form-row no-gutters="true">
                <x-field-date id="OUTSTART" picker-option="TimeOnly" xs-size="6" caption="Batas Pulang" time-format="HH:mm" binding-field="OUTSTART" read-only="@ViewBag.ReadOnly"></x-field-date>
                <x-field-date id="OUTEND" picker-option="TimeOnly" xs-size="6" caption="&nbsp;" time-format="HH:mm" binding-field="OUTEND" read-only="@ViewBag.ReadOnly"></x-field-date>
            </x-form-row>
        </x-form-col>
        @*<script>helper.initDateRange2('OUTSTART', 'OUTEND', 'HH:mm')</script>*@
    </x-form-row>
    <x-form-row id="pnlHoliday2">
        <x-form-col xs-size="12" md-size="6">
            <x-form-row no-gutters="true">
                <x-field-date id="BREAKSTART" picker-option="TimeOnly" xs-size="6" caption="Istirahat" time-format="HH:mm" binding-field="BREAKSTART" read-only="@ViewBag.ReadOnly"></x-field-date>
                <x-field-date id="BREAKEND" picker-option="TimeOnly" xs-size="6" caption="&nbsp;" time-format="HH:mm" binding-field="BREAKEND" read-only="@ViewBag.ReadOnly"></x-field-date>
            </x-form-row>
        </x-form-col>
        @*<script>helper.initDateRange2('BREAKSTART', 'BREAKEND', 'HH:mm')</script>*@
        <x-field-date id="INTIME" picker-option="TimeOnly" xs-size="12" md-size="3" caption="Jadwal Datang" time-format="HH:mm" binding-field="INTIME" read-only="@ViewBag.ReadOnly"></x-field-date>
        <x-field-date id="OUTTIME" picker-option="TimeOnly" xs-size="12" md-size="3" caption="Jadwal Pulang" time-format="HH:mm" binding-field="OUTTIME" read-only="@ViewBag.ReadOnly"></x-field-date>
    </x-form-row>
    <x-form-row id="pnlHoliday3">
        <x-field-number id="WORKHOUR" binding-field="WORKHOUR" caption="Jam Kerja" read-only="@ViewBag.ReadOnly" xs-size="12" md-size="3"></x-field-number>
    </x-form-row>
</x-form>



<script>
    var mode = "@(mode)";

    var ShowHidePanel = function (panelId, show) {
        if ($('#' + panelId)) {
            if (show)
                $('#' + panelId).show();
            else
                $('#' + panelId).hide();
        }
    };

    var beforeDisplay = function () {
        //$('#HOLIDAY').on('change', function () {
        //    var show = true;
        //    if ($(this).val() && $(this).val() === "true")
        //        show = false;
        //    ShowHidePanel('pnlHoliday1', show);
        //    ShowHidePanel('pnlHoliday2', show);
        //    ShowHidePanel('pnlHoliday3', show);
        //});
        return true;
    };

    var customDisplay = function () {      
        //var show = !record.HOLIDAY;

        ////if (record.HOLIDAY) {
        ////    show = false;
        ////    $('#HOLIDAY').val('true').trigger('change');
        ////}
        ////else
        ////    $('#HOLIDAY').val('false').trigger('change');

        //ShowHidePanel('pnlHoliday1', show);
        //ShowHidePanel('pnlHoliday2', show);
        //ShowHidePanel('pnlHoliday3', show);
        return true;
    }

    var beforeSaveRecord = function () {        
        return true;
    }

    var beforeSendAction = function (action, savedRecord) {
        var errorTitle = action + ' - ' + '@ViewBag.Title';

        if (action == "New" || action == "Edit") {

            if (!savedRecord.EMPLOYEEID) {
                showError(errorTitle, 'Karyawan tidak boleh kosong')
                return false;
            }

            if (!savedRecord.DATE) {
                showError(errorTitle, 'Tanggal tidak boleh kosong')
                return false;
            }

            if (savedRecord.HOLIDAY === "true" || savedRecord.HOLIDAY === true)
                savedRecord.HOLIDAY = true;

            else
            {
                savedRecord.HOLIDAY = false;
                if (!savedRecord.INSTART) {
                    showError(errorTitle, 'Batas Datang Awal tidak boleh kosong')
                    return false;
                }

                if (!savedRecord.INEND) {
                    showError(errorTitle, 'Batas Datang Akhir tidak boleh kosong')
                    return false;
                }

                if (!savedRecord.OUTSTART) {
                    showError(errorTitle, 'Batas Pulang Awal tidak boleh kosong')
                    return false;
                }

                if (!savedRecord.OUTEND) {
                    showError(errorTitle, 'Batas Pulang Akhir tidak boleh kosong')
                    return false;
                }

                if (!savedRecord.INTIME) {
                    showError(errorTitle, 'Jadwal Datang tidak boleh kosong')
                    return false;
                }

                if (!savedRecord.OUTTIME) {
                    showError(errorTitle, 'Jadwal Pulang tidak boleh kosong')
                    return false;
                }
            }
        }
        return savedRecord;
    }
</script>