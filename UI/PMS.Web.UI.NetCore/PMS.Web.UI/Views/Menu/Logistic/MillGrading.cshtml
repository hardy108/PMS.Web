@using PMS.Web.UI.Code
@using PMS.Shared.Models
@{
    ViewData["Title"] = "Mill Grading";
    Layout = null ;

    string mode = ViewBag.Mode;

    DateTime now = DateTime.Now;
    string strNow = now.ToString("yyyy-MM-dd HH:mm:ss");
    string strToday = now.ToString("yyyy-MM-dd");

}
<x-form id="@ViewBag.MainFormID">
    <x-form-row>
        <input type="hidden" name="ID" id="ID" data-bf="ID" />

        <x-field-data-list-unit-by-user-name id="UNITID" caption="Estate" xs-size="12" md-size="4" read-only="@ViewBag.ReadOnlyWhenNotInsert" binding-field="UNITID" min-length-search="0">
        </x-field-data-list-unit-by-user-name>

        @*<x-field-data-list-divisi id="DIVID" binding-field="DIVID" caption="Divisi" multiple="false" xs-size="12" md-size="4" read-only="@ViewBag.ReadOnly"
                                  Ascendants="@(new List<FilterAscendant> { new FilterAscendant { ElementID = "UNITID", FieldID = "UnitID" }})"
                                  value-field="DIVID" min-length-search="2" >
                                  is-unit-mandatory="true">
        </x-field-data-list-divisi>*@

        <x-field-data-list-divisi id="DIVID" caption="Divisi" xs-size="12" md-size="4" read-only="@ViewBag.ReadOnlyWhenNotInsert" binding-field="DIVID" min-length-search="3"
                                    chain-to-relatives="@(!ViewBag.ReadOnlyWhenNotInsert)"
                                    ascendants="@(ViewBag.ReadOnlyWhenNotInsert ? new List<FilterAscendant>() : new List<FilterAscendant> { new FilterAscendant { ElementID="UNITID",FieldID = "UnitID"}})">
            is-unit-mandatory="true">
        </x-field-data-list-divisi>

        <x-field-text binding-field="STATUS" caption="Status" read-only="true" place-holder="Status" xs-size="12" md-size="4">
        </x-field-text>
    </x-form-row>
    <x-form-row>
        <x-field-date binding-field="GRADINGDATE" caption="Tanggal" read-only="@ViewBag.ReadOnlyWhenNotInsert" xs-size="12" md-size="4" picker-option="DateOnly" date-format="dd-MMM-yyyy">
        </x-field-date>
        
        <x-field-number id="QTYPCT" binding-field="QTYPCT" read-only="@ViewBag.ReadOnly" value="0" caption="Brondolan (%)" xs-size="12" md-size="4"></x-field-number>
    </x-form-row>
</x-form>

<script>
    var mode = "@(mode)";
        var dictAllowedMode = {
            "A": ["Display", "Delete"],
            "D": ["Display"]
        };

        var checkMode = function () {
            if (typeof dictAllowedMode[record.STATUS] !== 'undefined') {
                var allowedMode = dictAllowedMode[record.STATUS];
                var allowed = false;
                if (Array.isArray(allowedMode) && allowedMode.length > 0) {
                    allowedMode.forEach(function (modeOk) {
                        if (modeOk === mode) {
                            allowed = true;
                            return;
                        }
                    });
                    if (!allowed) {
                        alert("Maaf anda tidak diijinkan untuk melakukan " + mode + " atas data ini");
                        mode = allowedMode[0];
                        return true;
                    }

                }
                if (!allowed) {
                    alert("Maaf anda tidak diijinkan untuk melakukan apapun atas data ini");
                    return false;
                }
            }
            return true;
        };
</script>
